---
 - hosts: switches
   connection: local
   gather_facts: False
   tasks:
    - name: "Fetching switch config"
      napalm_install_config:
        hostname: "{{ ansible_host }}"
        username: "{{ user }}"
        dev_os: "{{ os }}"
        password: "{{ passwd }}"
        commit_changes: False
        config:  " "
        archive_file: 'configs/{{ inventory_hostname }}-running.conf'

    - name: commit 
      shell: "{{ item }}"
      args:
        chdir: ~/git/napalm-net 
      with_items:
       - git pull
       - git add configs/
       - "git commit -m '{{ inventory_hostname }}-running.conf'"
       - git push -u origin master
       






